import {d}from'./chunk-MHDB44NA.js';import {allTags,withLifecycle,onLifecycle}from'../cardboard.js';var f=/[-[\]{}()+?.,\\^$|#\s]/g,R=/([:*])(\w+)/g;function _(n,t){let e=n.toString(n).charAt(8);return e==="R"?n.test(t):e==="F"?n(t):n==t}var g=(n,t={})=>{let e={},r=[],o=n;return typeof o=="string"?(o=o.replace(f,"\\$&"),o=o.replace(R,function(s,i,a){return r.push(a),i===":"?"([^/]*)":"(.*)"}),o=new RegExp("^"+o+"$"),e.parse=function(s){let i=0,a,u,p={},d=s.match(o);if(!d)return null;for(;i<r.length;){if(a=r[i++],u=d[i],t&&a in t&&!_(t[a],u))return null;p[a]=u;}return p},e.stringify=function(s){let i,a,u=n;for(i in s)a=new RegExp("[:*]"+i+"\\b"),u=u.replace(a,s[i]);return u.replace(R,"")}):(e.parse=function(s){let i=s.match(o);return i&&{captures:i.slice(1)}},e.stringify=function(){return ""}),e};var {div:v,a:b}=allTags,c=class{constructor(t){this._routes={};this._routeMatchers=[];this.params={};this.query=new URLSearchParams;var e;this._options=t,this._rootParent=t.rootParent,this._window=(e=t.window)!=null?e:window,this._location=this._window.location,this._history=this._window.history,this._initRouteMatchers(),this._modifyPushState(),this._listenEvents(),this.navigate(this._options.initialRoute);}get currentRoute(){return this._currentRoute}navigate(t,e){let r=new URLSearchParams(e),o=r.toString(),s=this.query.toString();(t!==this._currentRoute||o!==s)&&(this.query=r,this._history.pushState("data","",t+(o?"?"+o:"")));}_setRoute(){return d(this,null,function*(){this._currentTag&&(yield this._currentTag.hide());let t=this._getRoute();t.parent?yield t.show():(this._hookLifecycle(t),this._rootParent.append(t)),this._currentTag=t;})}_hookLifecycle(t){let e=this._options;!e.unmounted&&!e.mounted||(withLifecycle(t,{mounted:e.mounted,unmounted:e.unmounted,beforeUnmounted:e.beforeUnmounted}),onLifecycle(t,e.mounted,e.unmounted,e.beforeUnmounted));}_getEffectiveRoute(){if(!this._currentRoute)return;let t=this._currentRoute,e=1e4,r;for(;typeof(r=this._options.routes[t])=="string"&&e--&&typeof r=="string";)t=r;return t}_getRoute(){let t=this._getEffectiveRoute(),e=this._options,r=t,o=false;this.query=new URLSearchParams(this._location.search);for(let{matcher:i,key:a}of this._routeMatchers){let u=i.parse(r);if(u){this.params=u,r=a,o=true;break}}if(o||(r=e.fallbackRoute),!(r in e.routes))return e.noRouteBuilder?e.noRouteBuilder(this):v("No route found for: "+t);if(this._routes[r])return this._routes[r].show(),this._routes[r];let s=e.routes[r];if(typeof s!="function")throw new Error("Can't find route builder for "+this._currentRoute);return this._routes[r]=s(this)}_setCurrentRoute(){this.currentRoute!==this._location.pathname&&(this._currentRoute=this._location.pathname,this._setRoute());}_listenEvents(){this._window.addEventListener("popstate",this._setCurrentRoute.bind(this)),this._window.addEventListener("pushstate",this._setCurrentRoute.bind(this));}_modifyPushState(){let t=this._history.pushState;this._history.pushState=(...e)=>{t.call(this._history,...e),this._window.dispatchEvent(new window.Event("pushstate"));};}_initRouteMatchers(){for(let t in this._options.routes)this._routeMatchers.push({key:t,matcher:g(t)});}},h,E=n=>h=new c(n),P=(n,t,e)=>b(n).addAttr("href","javascript:;").setStyle({margin:"0 8px 0 0"}).clicked(()=>{if(!h)throw new Error("Link can	 navigate, there is no router available");h.navigate(t,e);});export{P as Link,c as Router,E as makeRouter,h as router};