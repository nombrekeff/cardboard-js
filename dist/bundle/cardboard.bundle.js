var Cardboard=(()=>{var L=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var m=(r,e)=>{for(var t in e)L(r,t,{get:e[t],enumerable:!0})},se=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of re(e))!ne.call(r,s)&&s!==t&&L(r,s,{get:()=>e[s],enumerable:!(n=te(e,s))||n.enumerable});return r};var ie=r=>se(L({},"__esModule",{value:!0}),r);var ce={};m(ce,{CEvent:()=>f,CMappedEvent:()=>g,CTag:()=>v,Cardboard:()=>he,CssGenerator:()=>C,Link:()=>ee,Router:()=>w,allTags:()=>M,attach:()=>H,attached:()=>J,camelToDash:()=>T,detach:()=>z,detachAll:()=>W,fromJson:()=>q,init:()=>G,isArray:()=>_,isObject:()=>p,makeRouter:()=>Y,mappedEvent:()=>F,onLifecycle:()=>x,removeFromList:()=>b,router:()=>R,singleEvent:()=>D,state:()=>P,state_:()=>Q,tag:()=>y,text:()=>E,toJson:()=>$,val:()=>d,withLifecycle:()=>U});var j={};m(j,{CTag:()=>v,allTags:()=>M,attach:()=>H,attached:()=>J,detach:()=>z,detachAll:()=>W,init:()=>G,onLifecycle:()=>x,tag:()=>y,withLifecycle:()=>U});var N={};m(N,{CssGenerator:()=>C});var I={};m(I,{camelToDash:()=>T,fromJson:()=>q,isArray:()=>_,isObject:()=>p,removeFromList:()=>b,toJson:()=>$,val:()=>d});function b(r,e){if(!e)return!1;let t=e.indexOf(r);return t!==-1?(e.splice(t,1),!0):!1}var T=r=>r.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`);function p(r){return typeof r=="object"&&!(r instanceof Array)}function _(r){return Object.prototype.toString.call(r)==="[object Array]"}var $=r=>JSON.parse(r),q=r=>JSON.stringify(r),d=(r,...e)=>typeof r=="function"?r(...e):r;var C=class{genCss(e){let t=e instanceof Array?e:[e],n="";for(let s of t)for(let o in s)n+=this.genBlock(o,s[o]);return n}genBlock(e,t){return this.genBlockContent(e,t).join("")}genBlockContent(e,t){let n="",s=[];for(let o in t)p(t[o])?s.push(this.genBlockContent(e+o,t[o])):t[o]&&(n+=this.genStyle(o,t[o]));return s.unshift(`${e}{${n}}`),s}genStyle(e,t){return`${T(e)}:${t};`}};var K={};m(K,{text:()=>E});function E(r,e){let t=document.createTextNode(""),n=/\B\$([0-9]+|[a-z][a-z0-9_$]*)/gi,s=()=>{t.nodeValue=e?r.replace(n,(o,l)=>e[l]!=null?e[l]:o):r};if(e&&"changed"in e)for(let o of Object.getOwnPropertyNames(e))r.includes(`$${o}`)&&e[o].changed(s);return s(),t}var A={};m(A,{CEvent:()=>f,CMappedEvent:()=>g,mappedEvent:()=>F,singleEvent:()=>D});var f=class{constructor(){this._listeners=[]}listen(e){this._listeners.push(e)}remove(e){b(e,this._listeners)}dispatch(e){this._listeners.forEach(t=>t(e))}},g=class{constructor(){this._listeners={}}listen(e,t){e in this._listeners?this._listeners[e].push(t):this._listeners[e]=[t]}remove(e,t){b(t,this._listeners[e])}dispatch(e,t){e in this._listeners&&this._listeners[e].forEach(n=>n(t))}};function D(){return new f}function F(){return new g}var O=class extends f{constructor(t){super();this._value=t}get value(){return this._value}valueOf(){return this._value}toString(){return this._value.toString()}changed(t){this.listen(t)}dispatch(t){this._value=t,super.dispatch(t)}updateVal(t){this._value=t}};function S(r){return new O(r)}var h={attached:null,stack:[],css:new C};function J(){return h.attached}var v=class r{constructor(e,t=[],n=!1){this._parent=null;this._children=[];this._cachedChildren=[];this._attachable=!1;this._meta={isHidden:!1,nextSiblingID:null};if(this._attachable=!1,typeof e=="string"&&e.match(/\(.+\)/))this.element=document.querySelector(e.match(/\((.+)\)/)[1]);else if(typeof e=="string")this._attachable=n,this.element=document.createElement(e);else if(e instanceof HTMLElement)this.element=e;else throw new Error("Invalid argument 0");h.attached&&this._attachable&&h.attached.append(this),t.length>0&&this.setChildren(t)}get parent(){return this._parent}set parent(e){this._parent=e}get children(){return this._getChildren(this.element),this._cachedChildren}get value(){return this.element.value}get style(){return this.element.style}get className(){return this.element.className}get classList(){return this.element.classList}setValue(e){return this.element.value=e,this}get consumeValue(){let e=this.value;return this.clear(),e}get id(){return this.element.id}setId(e){return this.element.id=e,this}setChildren(e){return this.element.replaceChildren(...this._mapChildren(e)),this._children=e,this}append(...e){return this.element.append(...this._mapChildren(e)),this._children.push(...e),this}prepend(...e){return this.element.prepend(...this._mapChildren(e)),this._children.unshift(...e),this}consume(e,t){return e.changed(n=>t(this,n)),t(this,e),this}async show(){if(!this.parent.children.includes(this.element)){let e=this.parent.element,t=this.parent._children.indexOf(this);if(t==0)e.prepend(this.element);else if(t==this.parent._children.length-1)e.append(this.element);else{let n=0;for(let o=t-1;o>=0;o--){let l=this.parent._children[o];l instanceof r&&l._meta.isHidden&&n++}let s=e.childNodes[t-n];e.insertBefore(this.element,s)}}return this._meta.isHidden=!1,!0}async hide(){this.parent.children.includes(this.element)&&(await this.remove(),this._meta.isHidden=!0)}doIf(e,t,n,s=!1){if(s){let l=t;t=n,n=l}let o=l=>{l?t(l):n(l)};return e.changed(o),o(e.value),this}doIfNot(e,t,n){return this.doIf(e,t,n,!0)}hideIf(e,t=!1){let n=s=>{let o=t?!s:!!s;this._meta.isHidden=o,this.parent&&(o?this.hide():this.show())};return e.changed(n),n(e.value),this}hideIfNot(e){return this.hideIf(e,!0)}classIf(e,t,n=!1){return this.doIf(e,()=>this.addClass(...d(t,this)),()=>this.rmClass(...d(t,this)),n)}classIfNot(e,t){return this.classIf(e,t,!0)}textIf(e,t,n="",s=!1){return this.doIf(e,()=>this.text(d(t,this)),()=>this.text(d(n,this)),s)}textIfNot(e,t,n=""){return this.textIf(e,t,n,!0)}attrIf(e,t,n="",s=!1){return this.doIf(e,()=>this.addAttr(t,d(n,this)),()=>this.rmAttr(t),s)}attrIfNot(e,t,n=""){return this.attrIf(e,t,n,!0)}disableIf(e,t=!1){return this.attrIf(e,"disabled","",t)}disableIfNot(e){return this.disableIf(e,!0)}styleIf(e,t,n="",s=!1){return this.doIf(e,()=>this.addStyle(t,d(n,this)),()=>this.rmStyle(t),s)}styleIfNot(e,t,n=""){return this.styleIf(e,t,n,!0)}stylesIf(e,t,n=!1){return this.doIf(e,()=>this.setStyle(d(t,this)),()=>this.rmStyle(...Object.keys(t)),n)}stylesIfNot(e,t){return this.stylesIf(e,t,!0)}listen(e,t,n){return e.on(t,(s,o)=>n(this,s,o))}text(e,t){return e==null?this.element.textContent:t&&e?this.setChildren([E(e,t)]):(this.element.textContent=e,this)}config(e){if(e.attr&&this.setAttrs(e.attr),e.classList&&this.addClass(...e.classList),e.className&&this.setClassName(e.className),e.style&&this.setStyle(e.style),e.text&&this.text(e.text),e.value&&this.setValue(e.value),e.children&&this.append(...e.children),e.on)for(let t in e.on)this.on(t,e.on[t]);return this}addClass(...e){return this.classList.add(...e),this}setClassName(e){return this.element.className=e,this}rmClass(...e){for(let t of e)this.classList.remove(t);return this}hasClass(...e){for(let t of e)if(!this.classList.contains(t))return!1;return!0}replaceClass(e,t){return this.classList.replace(e,t),this}toggleClass(e){return this.hasClass(e)?this.rmClass(e):this.addClass(e)}addStyle(e,t){return this.element.style[e]=t,this}setStyle(e){for(let t in e)this.addStyle(t,e[t]);return this}rmStyle(...e){for(let t of e)this.style.removeProperty(t);return this}hasStyle(...e){for(let t of e)if(!this.style.getPropertyValue(T(t)))return!1;return!0}setAttrs(e){for(let t in e)this.addAttr(t,e[t]);return this}addAttr(e,t=""){return this.element.attributes[e]=t,this.element.setAttribute(e,t),this}rmAttr(...e){for(let t of e)this.element.removeAttribute(t),delete this.element.attributes[t];return this}hasAttr(...e){for(let t of e)if(!(t in this.element.attributes))return!1;return!0}getAttr(e){return this.element.attributes[e]}when(e,t){let n=S({});return this.on(e,(s,o)=>n.dispatch(t(s,o))),n}on(e,t){return this.element.addEventListener(e,n=>t(this,n)),this}once(e,t){let n=s=>{t(this,s),this.element.removeEventListener(e,n)};return this.element.addEventListener(e,n),this}clicked(e){return this.on("click",e)}keyPressed(e,t){return t?this.on("keypress",(n,s)=>{(s.code==t||s.key==t)&&e(this,s)}):this.on("keypress",e)}changed(e){return this.on("change",e)}submited(e){return this.on("submit",e)}async remove(){return await this.element.remove(),this}clear(){return this.element.value="",this.element.dispatchEvent(new InputEvent("input")),this}disable(){return this.setDisabled(!0)}enable(){return this.setDisabled(!1)}setDisabled(e){return e?this.addAttr("disabled"):this.rmAttr("disabled")}q(e){let t=this.element.querySelector(e);if(t)return new r(t)}find(e){for(let t of this._children)if(e(t))return t}findTag(e){for(let t of this._children)if(t instanceof r&&e(t))return t}_setChildrenParent(e){return e instanceof r&&(e.parent=this),e}_childrenFilterPredicate(e){return!(e instanceof r&&e._meta.isHidden)}_getElementForChild(e){return typeof e=="string"?document.createTextNode(e):e instanceof r?e.element:e instanceof Node?e:null}_getChildren(e){this._observer||(this._observer=new MutationObserver(()=>{this._cacheChildren(e)}),this._observer.observe(this.element,{childList:!0}),this._cacheChildren(e))}_cacheChildren(e){let t=e.childNodes,n=[],s=t.length;for(;s--;)t[s].nodeType==1&&n.unshift(t[s]);this._cachedChildren=n}_mapChildren(e){return e.map(this._setChildrenParent.bind(this)).filter(this._childrenFilterPredicate.bind(this)).map(this._getElementForChild)}};function y(r,e=[],t=!1){return new v(r,e,t)}function x(r,e,t,n){let s=!1;if(n){let l=r.element.remove;r.element.remove=async()=>{let i=n(r);return(!i||i instanceof Promise&&await i)&&l.call(r.element),i}}if(e){let l=r.show;r.show=async()=>{let i=l.call(r);return i instanceof Promise?await i:i}}let o=new MutationObserver(async(l,i)=>{let a=!1,u=!1;for(let c of l)e&&Array.from(c.addedNodes).includes(r.element)&&(a=!0),t&&Array.from(c.removedNodes).includes(r.element)&&(u=!0);if(a&&e){let c=e(r);c instanceof Promise&&await c,s||(i.disconnect(),i.observe(r.element.parentElement,{childList:!0}),s=!0)}u&&t&&t(r)});return o.observe(r.parent?.element??document.body,{childList:!0,subtree:!0}),o}var U=(r,e)=>(x(r,e.start,e.removed,e.beforeRemove),r);function H(r){return h.attached&&h.stack.push(h.attached),h.attached=r,r}function z(){h.stack.length>0?h.attached=h.stack.pop():h.attached=null}function W(){h.attached=null,h.stack=[]}function G(r={root:"body"}){let e=new v(`(${r.root})`);return H(e),e}var k={ul:(r,e=!1)=>y("ul",r.map(t=>y("li",[t],e))),style:(r,e=!1)=>y("style",[h.css.genCss(r)],e)},M=new Proxy({},{get:(r,e,t)=>{let n=e.toString(),s=(...o)=>k[n]?k[n](o,!1):y(n,o);return Object.defineProperty(s,"attach",{get:()=>(...o)=>k[n]?k[n](o,!0):y(n,o,!0)}),s}});var B={};m(B,{state:()=>P,state_:()=>Q});function Q(r,e){let t=new g,n=new f;e&&n.listen(e);let s=(i,a)=>{t.dispatch(a,i[a]),n.dispatch(i)},o=(i,a)=>{let u=i[a];try{p(u)?u.changed=c=>t.listen(a,c):u.__proto__&&(u.__proto__.changed=c=>t.listen(a,c))}catch{}return u};for(let i of Object.getOwnPropertyNames(r)){let a=r[i];(p(a)||_(a))&&(r[i]=P(a,s.bind(this,r,i)))}let l=new Proxy(r,{deleteProperty:function(i,a){return s(i,a),delete i[a],!0},get:(i,a)=>o(i,a),set:(i,a,u)=>a=="changed"?(i[a]=u,!0):(i[a]=u,s(i,a),!0)});return l.changed=i=>n.listen(i),l}function P(r,e){let t=new f,n={};e&&t.listen(e);let s=(i,a,u)=>{i[a]=u,n[a]!=null&&(console.log({target:i,prop:a,value:u}),n[a].dispatch(u)),t.dispatch(i)},o=(i,a)=>n[a]=S(i[a]);for(let i of Object.getOwnPropertyNames(r)){let a=r[i];p(a)||_(a)?r[i]=P(a,s.bind(this,r,i)):typeof a!="function"&&o(r,i)}let l=new Proxy(r,{deleteProperty:function(i,a){return s(i,a,i[a]),delete i[a],!0},get:(i,a)=>n[a]??i[a],set:(i,a,u)=>a=="changed"&&!i[a]?(i[a]=u,!0):(s(i,a,u),!0)});return l.changed=i=>t.listen(i),l}var V={};m(V,{Link:()=>ee,Router:()=>w,makeRouter:()=>Y,router:()=>R});var ae=/[\-\[\]{}()+?.,\\\^$|#\s]/g,Z=/([:*])(\w+)/g;function oe(r,e){var t=r.toString.call(r).charAt(8);return t==="R"?r.test(e):t==="F"?r(e):r==e}var X=(r,e={})=>{let t={},n=[],s=r;return typeof s=="string"?(s=s.replace(ae,"\\$&"),s=s.replace(Z,function(o,l,i){return n.push(i),l===":"?"([^/]*)":"(.*)"}),s=new RegExp("^"+s+"$"),t.parse=function(o){let l=0,i,a,u={},c=o.match(s);if(!c)return null;for(;l<n.length;){if(i=n[l++],a=c[l],e&&i in e&&!oe(e[i],a))return null;u[i]=a}return u},t.stringify=function(o){let l,i,a=r;for(l in o)i=new RegExp("[:*]"+l+"\\b"),a=a.replace(i,o[l]);return a.replace(Z,"")}):(t.parse=function(o){let l=o.match(s);return l&&{captures:l.slice(1)}},t.stringify=function(){return""}),t};var{div:le,a:ue}=M,w=class{constructor(e){this._routes={};this._routeMatchers=[];this.params={};this.query=new URLSearchParams;this._options=e,this._rootParent=e.rootParent,this._window=e.window??window,this._location=this._window.location,this._history=this._window.history,this._initRouteMatchers(),this._modifyPushState(),this._listenEvents(),this.navigate(this._options.initialRoute)}get currentRoute(){return this._currentRoute}navigate(e,t){let n=new URLSearchParams(t),s=n.toString(),o=this.query.toString();(e!=this._currentRoute||s!==o)&&(this.query=n,this._history.pushState("data","",e+(s?"?"+s:"")))}async _setRoute(){this._currentTag&&await this._currentTag.hide();let e=this._getRoute();e.parent?await e.show():(this._hookLifecycle(e),this._rootParent.append(e)),this._currentTag=e}_hookLifecycle(e){let t=this._options;!t.remove&&!t.start||x(e,t.start?t.start:null,t.remove?t.remove:null,t.beforeRemove?t.beforeRemove:null)}_getEffectiveRoute(){let e=this._currentRoute,t=1e4,n;for(;typeof(n=this._options.routes[e])=="string"&&t--&&typeof n=="string";)e=n;return e}_getRoute(){let e=this._getEffectiveRoute(),t=e,n=!1,s=this._options;this.query=new URLSearchParams(this._location.search);for(let{matcher:l,key:i}of this._routeMatchers){let a=l.parse(t);if(a){this.params=a,t=i,n=!0;break}}if(n||(t=s.fallbackRoute),!(t in s.routes))return s.noRouteBuilder?s.noRouteBuilder(this):le("No route found for: "+e);if(this._routes[t])return this._routes[t].show(),this._routes[t];let o=s.routes[t];if(typeof o!="function")throw new Error("Can find route builder for "+this._currentRoute);return this._routes[t]=o(this)}_setCurrentRoute(){this.currentRoute!=this._location.pathname&&(this._currentRoute=this._location.pathname,this._setRoute())}_listenEvents(){this._window.addEventListener("popstate",this._setCurrentRoute.bind(this)),this._window.addEventListener("pushstate",this._setCurrentRoute.bind(this))}_modifyPushState(){let e=this._history.pushState;this._history.pushState=(...t)=>{e.call(this._history,...t),this._window.dispatchEvent(new window.Event("pushstate"))}}_initRouteMatchers(){for(let e in this._options.routes)this._routeMatchers.push({key:e,matcher:X(e)})}},R;function Y(r){return R=new w(r)}function ee(r,e,t){return ue(r).addAttr("href","javascript:;").setStyle({margin:"0 8px 0 0"}).clicked(()=>{if(!R)throw new Error("Link can	 navigate, there is no router available");R.navigate(e,t)})}var he={...j,...B,...N,...I,...K,...A,...V};return ie(ce);})();
