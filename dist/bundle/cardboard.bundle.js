var Cardboard=(()=>{var N=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var ae=Object.prototype.hasOwnProperty;var m=(r,e)=>{for(var t in e)N(r,t,{get:e[t],enumerable:!0})},oe=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ie(e))!ae.call(r,s)&&s!==t&&N(r,s,{get:()=>e[s],enumerable:!(n=se(e,s))||n.enumerable});return r};var le=r=>oe(N({},"__esModule",{value:!0}),r);var pe={};m(pe,{CEvent:()=>f,CMappedEvent:()=>C,CTag:()=>T,Cardboard:()=>me,Link:()=>ne,Router:()=>w,allTags:()=>P,attach:()=>V,attached:()=>Q,camelToDash:()=>g,detach:()=>G,detachAll:()=>X,fromJson:()=>U,genBlock:()=>A,genBlockContent:()=>S,genCss:()=>E,genStyle:()=>O,init:()=>Y,isArray:()=>I,isObject:()=>y,makeRouter:()=>re,mappedEvent:()=>W,onLifecycle:()=>x,removeFromList:()=>b,router:()=>R,singleEvent:()=>z,state:()=>q,tag:()=>p,text:()=>_,toJson:()=>J,val:()=>c,withLifecycle:()=>Z});var $={};m($,{CTag:()=>T,allTags:()=>P,attach:()=>V,attached:()=>Q,detach:()=>G,detachAll:()=>X,init:()=>Y,onLifecycle:()=>x,tag:()=>p,withLifecycle:()=>Z});var H={};m(H,{genBlock:()=>A,genBlockContent:()=>S,genCss:()=>E,genStyle:()=>O});var K={};m(K,{camelToDash:()=>g,fromJson:()=>U,isArray:()=>I,isObject:()=>y,removeFromList:()=>b,toJson:()=>J,val:()=>c});function b(r,e){if(!e)return!1;let t=e.indexOf(r);return t!==-1?(e.splice(t,1),!0):!1}var g=r=>r.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`);function y(r){return typeof r=="object"&&!(r instanceof Array)}function I(r){return Object.prototype.toString.call(r)==="[object Array]"}var J=r=>JSON.parse(r),U=r=>JSON.stringify(r),c=(r,...e)=>typeof r=="function"?r(...e):r;function E(r){let e=r instanceof Array?r:[r],t="";for(let n of e)for(let s in n)t+=A(s,n[s]);return t}function A(r,e){return S(r,e).join("")}function S(r,e){let t="",n=[];for(let s in e)y(e[s])?n.push(S(r+s,e[s])):e[s]&&(t+=O(s,e[s]));return n.unshift(`${r}{${t}}`),n}function O(r,e){return`${g(r)}:${e};`}var B={};m(B,{text:()=>_});var j={};m(j,{CEvent:()=>f,CMappedEvent:()=>C,mappedEvent:()=>W,singleEvent:()=>z});var f=class{constructor(){this._listeners=[]}listen(e){this._listeners.push(e)}remove(e){b(e,this._listeners)}dispatch(e){this._listeners.forEach(t=>t(e))}},C=class{constructor(){this._listeners={}}listen(e,t){e in this._listeners?this._listeners[e].push(t):this._listeners[e]=[t]}remove(e,t){b(t,this._listeners[e])}dispatch(e,t){e in this._listeners&&this._listeners[e].forEach(n=>n(t))}};function z(){return new f}function W(){return new C}var k=class extends f{constructor(t){super();this._value=t}get value(){return this._value}set value(t){this.dispatch(t)}valueOf(){return this._value}toString(){return this._value.toString()}changed(t){this.listen(t)}dispatch(t){this._value=t,super.dispatch(t)}intersect(t){return ue(this,t)}};function M(r){return r instanceof k}function v(r){return new k(r)}function ue(r,e){let t=v(e(r.value));return r.changed(n=>t.dispatch(e(n))),t}function _(r,e){let t=document.createTextNode(""),n=/\B\$([0-9]+|[a-z][a-z0-9_$]*)/gi,s=()=>{t.nodeValue=e?r.replace(n,(a,l)=>e[l]!=null?e[l]:a):r};if(e)for(let a of Object.getOwnPropertyNames(e))r.includes(`$${a}`)&&M(e[a])&&e[a].changed(s);return s(),t}var u={attached:null,stack:[]};function Q(){return u.attached}var T=class r{constructor(e,t=[],n=!1){this._parent=null;this._children=[];this._cachedChildren=[];this._attachable=!1;this._meta={isHidden:!1,nextSiblingID:null};if(this._attachable=!1,typeof e=="string"&&e.match(/\(.+\)/))this.element=document.querySelector(e.match(/\((.+)\)/)[1]);else if(typeof e=="string")this._attachable=n,this.element=document.createElement(e);else if(e instanceof HTMLElement)this.element=e;else throw new Error("Invalid argument 0");u.attached&&this._attachable&&u.attached.append(this),t.length>0&&this.setChildren(t)}get parent(){return this._parent}set parent(e){this._parent=e}get children(){return this._getChildren(this.element),this._cachedChildren}get value(){return this.element.value}get style(){return this.element.style}get className(){return this.element.className}get classList(){return this.element.classList}setValue(e){return this.element.value=e,this}get consumeValue(){let e=this.value;return this.clear(),e}get id(){return this.element.id}setId(e){return this.element.id=e,this}setChildren(e){return this.element.replaceChildren(...this._mapChildren(e)),this._children=e,this}append(...e){return this.element.append(...this._mapChildren(e)),this._children.push(...e),this}prepend(...e){return this.element.prepend(...this._mapChildren(e)),this._children.unshift(...e),this}consume(e,t){return e.changed(n=>t(this,n)),t(this,e.value),this}async show(){if(!this.parent.children.includes(this.element)){let e=this.parent.element,t=this.parent._children.indexOf(this);if(t==0)e.prepend(this.element);else if(t==this.parent._children.length-1)e.append(this.element);else{let n=0;for(let a=t-1;a>=0;a--){let l=this.parent._children[a];l instanceof r&&l._meta.isHidden&&n++}let s=e.childNodes[t-n];e.insertBefore(this.element,s)}}return this._meta.isHidden=!1,!0}async hide(){this.parent.children.includes(this.element)&&(await this.remove(),this._meta.isHidden=!0)}doIf(e,t,n,s=!1){if(s){let l=t;t=n,n=l}let a=l=>{l?t(l):n(l)};return e.changed(a),a(e.value),this}doIfNot(e,t,n){return this.doIf(e,t,n,!0)}hideIf(e,t=!1){let n=s=>{let a=t?!s:!!s;this._meta.isHidden=a,this.parent&&(a?this.hide():this.show())};return e.changed(n),n(e.value),this}hideIfNot(e){return this.hideIf(e,!0)}classIf(e,t,n=!1){return this.doIf(e,()=>this.addClass(...c(t,this)),()=>this.rmClass(...c(t,this)),n)}classIfNot(e,t){return this.classIf(e,t,!0)}textIf(e,t,n="",s=!1){return this.doIf(e,()=>this.text(c(t,this)),()=>this.text(c(n,this)),s)}textIfNot(e,t,n=""){return this.textIf(e,t,n,!0)}attrIf(e,t,n="",s=!1){return this.doIf(e,()=>this.addAttr(t,c(n,this)),()=>this.rmAttr(t),s)}attrIfNot(e,t,n=""){return this.attrIf(e,t,n,!0)}disableIf(e,t=!1){return this.attrIf(e,"disabled","",t)}disableIfNot(e){return this.disableIf(e,!0)}styleIf(e,t,n="",s=!1){return this.doIf(e,()=>this.addStyle(t,c(n,this)),()=>this.rmStyle(t),s)}styleIfNot(e,t,n=""){return this.styleIf(e,t,n,!0)}stylesIf(e,t,n=!1){return this.doIf(e,()=>this.setStyle(c(t,this)),()=>this.rmStyle(...Object.keys(t)),n)}stylesIfNot(e,t){return this.stylesIf(e,t,!0)}listen(e,t,n){return e.on(t,(s,a)=>n(this,s,a))}text(e,t){return e==null?this.element.textContent:t&&e?this.setChildren([_(e,t)]):(this.element.textContent=e,this)}config(e){if(e.attr&&this.setAttrs(e.attr),e.classList&&this.addClass(...e.classList),e.className&&this.setClassName(e.className),e.style&&this.setStyle(e.style),e.text&&this.text(e.text),e.value&&this.setValue(e.value),e.children&&this.append(...e.children),e.on)for(let t of Object.keys(e.on))this.on(t,e.on[t]);return this}addClass(...e){return this.classList.add(...e),this}setClassName(e){return this.element.className=e,this}rmClass(...e){for(let t of e)this.classList.remove(t);return this}hasClass(...e){for(let t of e)if(!this.classList.contains(t))return!1;return!0}replaceClass(e,t){return this.classList.replace(e,t),this}toggleClass(e){return this.hasClass(e)?this.rmClass(e):this.addClass(e)}addStyle(e,t){return this.element.style[e]=t,this}setStyle(e){for(let t in e)this.addStyle(t,e[t]);return this}rmStyle(...e){for(let t of e)this.style.removeProperty(t);return this}hasStyle(...e){for(let t of e)if(!this.style.getPropertyValue(g(t)))return!1;return!0}setAttrs(e){for(let t in e)this.addAttr(t,e[t]);return this}addAttr(e,t=""){return this.element.attributes[e]=t,this.element.setAttribute(e,t),this}rmAttr(...e){for(let t of e)this.element.removeAttribute(t),delete this.element.attributes[t];return this}hasAttr(...e){for(let t of e)if(!(t in this.element.attributes))return!1;return!0}getAttr(e){return this.element.attributes[e]}when(e,t){let n=v({});return this.on(e,(s,a)=>n.dispatch(t(s,a))),n}on(e,t){return t&&this.element.addEventListener(e,n=>t(this,n)),this}once(e,t){let n=s=>{t(this,s),this.element.removeEventListener(e,n)};return this.element.addEventListener(e,n),this}clicked(e){return this.on("click",e)}keyPressed(e,t){return t?this.on("keypress",(n,s)=>{(s.code==t||s.key==t)&&e(this,s)}):this.on("keypress",e)}changed(e){return this.on("change",e)}submited(e){return this.on("submit",e)}async remove(){return await this.element.remove(),this}clear(){return this.element.value="",this.element.dispatchEvent(new InputEvent("input")),this}disable(){return this.setDisabled(!0)}enable(){return this.setDisabled(!1)}setDisabled(e){return e?this.addAttr("disabled"):this.rmAttr("disabled")}q(e){let t=this.element.querySelector(e);if(t)return new r(t)}find(e){for(let t of this._children)if(e(t))return t}findTag(e){for(let t of this._children)if(t instanceof r&&e(t))return t}_setChildrenParent(e){return e instanceof r&&(e.parent=this),e}_childrenFilterPredicate(e){return!(e instanceof r&&e._meta.isHidden)}_getElementForChild(e){return typeof e=="string"?document.createTextNode(e):M(e)?_("$val",{val:e}):e instanceof r?e.element:e instanceof Node?e:null}_getChildren(e){this._observer||(this._observer=new MutationObserver(()=>{this._cacheChildren(e)}),this._observer.observe(this.element,{childList:!0}),this._cacheChildren(e))}_cacheChildren(e){let t=e.childNodes,n=[],s=t.length;for(;s--;)t[s].nodeType==1&&n.unshift(t[s]);this._cachedChildren=n}_mapChildren(e){return e.map(this._setChildrenParent.bind(this)).filter(this._childrenFilterPredicate.bind(this)).map(this._getElementForChild)}};function p(r,e=[],t=!1){return new T(r,e,t)}function x(r,e,t,n){let s=!1;if(n){let l=r.element.remove;r.element.remove=async()=>{let i=n(r);return(!i||i instanceof Promise&&await i)&&l.call(r.element),i}}if(e){let l=r.show;r.show=async()=>{let i=l.call(r);return i instanceof Promise?await i:i}}let a=new MutationObserver(async(l,i)=>{let o=!1,h=!1;for(let d of l)e&&Array.from(d.addedNodes).includes(r.element)&&(o=!0),t&&Array.from(d.removedNodes).includes(r.element)&&(h=!0);if(o&&e){let d=e(r);d instanceof Promise&&await d,s||(i.disconnect(),i.observe(r.element.parentElement,{childList:!0}),s=!0)}h&&t&&t(r)});return a.observe(r.parent?.element??document.body,{childList:!0,subtree:!0}),a}var Z=(r,e)=>(x(r,e.start,e.removed,e.beforeRemove),r);function V(r){return u.attached&&u.stack.push(u.attached),u.attached=r,r}function G(){u.stack.length>0?u.attached=u.stack.pop():u.attached=null}function X(){u.attached=null,u.stack=[]}function Y(r={root:"body"}){let e=new T(`(${r.root})`);return V(e),e}var L={ul:(r,e=!1)=>p("ul",r.map(t=>p("li",[t],e))),style:(r,e=!1)=>p("style",[E(r)],e)},P=new Proxy({},{get:(r,e,t)=>{let n=e.toString(),s=(...a)=>L[n]?L[n](a,!1):p(n,a);return Object.defineProperty(s,"attach",{get:()=>(...a)=>L[n]?L[n](a,!0):p(n,a,!0)}),s}});var D={};m(D,{state:()=>q});function q(r,e){let t=new f,n={};e&&t.listen(e);let s=(i,o,h)=>{i[o]=h,n[o]!=null&&n[o].dispatch(h),t.dispatch(i)},a=(i,o)=>n[o]=v(i[o]);for(let i of Object.getOwnPropertyNames(r)){let o=r[i];y(o)||I(o)?r[i]=q(o,s.bind(this,r,i)):typeof o!="function"&&!Number.isInteger(+i)&&a(r,i)}let l=new Proxy(r,{deleteProperty:function(i,o){return s(i,o,i[o]),delete i[o],!0},get:(i,o)=>n[o]??i[o],set:(i,o,h)=>o=="changed"&&!i[o]?(i[o]=h,!0):(s(i,o,h),!0)});return l.changed=i=>t.listen(i),l}var F={};m(F,{Link:()=>ne,Router:()=>w,makeRouter:()=>re,router:()=>R});var he=/[\-\[\]{}()+?.,\\\^$|#\s]/g,ee=/([:*])(\w+)/g;function ce(r,e){var t=r.toString.call(r).charAt(8);return t==="R"?r.test(e):t==="F"?r(e):r==e}var te=(r,e={})=>{let t={},n=[],s=r;return typeof s=="string"?(s=s.replace(he,"\\$&"),s=s.replace(ee,function(a,l,i){return n.push(i),l===":"?"([^/]*)":"(.*)"}),s=new RegExp("^"+s+"$"),t.parse=function(a){let l=0,i,o,h={},d=a.match(s);if(!d)return null;for(;l<n.length;){if(i=n[l++],o=d[l],e&&i in e&&!ce(e[i],o))return null;h[i]=o}return h},t.stringify=function(a){let l,i,o=r;for(l in a)i=new RegExp("[:*]"+l+"\\b"),o=o.replace(i,a[l]);return o.replace(ee,"")}):(t.parse=function(a){let l=a.match(s);return l&&{captures:l.slice(1)}},t.stringify=function(){return""}),t};var{div:fe,a:de}=P,w=class{constructor(e){this._routes={};this._routeMatchers=[];this.params={};this.query=new URLSearchParams;this._options=e,this._rootParent=e.rootParent,this._window=e.window??window,this._location=this._window.location,this._history=this._window.history,this._initRouteMatchers(),this._modifyPushState(),this._listenEvents(),this.navigate(this._options.initialRoute)}get currentRoute(){return this._currentRoute}navigate(e,t){let n=new URLSearchParams(t),s=n.toString(),a=this.query.toString();(e!=this._currentRoute||s!==a)&&(this.query=n,this._history.pushState("data","",e+(s?"?"+s:"")))}async _setRoute(){this._currentTag&&await this._currentTag.hide();let e=this._getRoute();e.parent?await e.show():(this._hookLifecycle(e),this._rootParent.append(e)),this._currentTag=e}_hookLifecycle(e){let t=this._options;!t.remove&&!t.start||x(e,t.start?t.start:null,t.remove?t.remove:null,t.beforeRemove?t.beforeRemove:null)}_getEffectiveRoute(){let e=this._currentRoute,t=1e4,n;for(;typeof(n=this._options.routes[e])=="string"&&t--&&typeof n=="string";)e=n;return e}_getRoute(){let e=this._getEffectiveRoute(),t=e,n=!1,s=this._options;this.query=new URLSearchParams(this._location.search);for(let{matcher:l,key:i}of this._routeMatchers){let o=l.parse(t);if(o){this.params=o,t=i,n=!0;break}}if(n||(t=s.fallbackRoute),!(t in s.routes))return s.noRouteBuilder?s.noRouteBuilder(this):fe("No route found for: "+e);if(this._routes[t])return this._routes[t].show(),this._routes[t];let a=s.routes[t];if(typeof a!="function")throw new Error("Can find route builder for "+this._currentRoute);return this._routes[t]=a(this)}_setCurrentRoute(){this.currentRoute!=this._location.pathname&&(this._currentRoute=this._location.pathname,this._setRoute())}_listenEvents(){this._window.addEventListener("popstate",this._setCurrentRoute.bind(this)),this._window.addEventListener("pushstate",this._setCurrentRoute.bind(this))}_modifyPushState(){let e=this._history.pushState;this._history.pushState=(...t)=>{e.call(this._history,...t),this._window.dispatchEvent(new window.Event("pushstate"))}}_initRouteMatchers(){for(let e in this._options.routes)this._routeMatchers.push({key:e,matcher:te(e)})}},R;function re(r){return R=new w(r)}function ne(r,e,t){return de(r).addAttr("href","javascript:;").setStyle({margin:"0 8px 0 0"}).clicked(()=>{if(!R)throw new Error("Link can	 navigate, there is no router available");R.navigate(e,t)})}var me={...$,...D,...H,...K,...B,...j,...F};return le(pe);})();
