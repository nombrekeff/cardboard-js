var Cardboard=(()=>{var G=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Be=Object.prototype.hasOwnProperty;var h=(r,e)=>{for(var t in e)G(r,t,{get:e[t],enumerable:!0})},We=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of qe(e))!Be.call(r,n)&&n!==t&&G(r,n,{get:()=>e[n],enumerable:!(s=Ve(e,n))||s.enumerable});return r};var ze=r=>We(G({},"__esModule",{value:!0}),r);var Ze={};h(Ze,{CEvent:()=>A,CMappedEvent:()=>k,CTag:()=>P,Cardboard:()=>Ue,DiffState:()=>ke,Observable:()=>M,allTags:()=>Le,arraysEqual:()=>Ce,camelToDash:()=>S,clearMountPoints:()=>Se,compute:()=>p,computeMultiple:()=>Ne,context:()=>l,createGlobalObserver:()=>N,createObservable:()=>g,deepEquals:()=>E,diffList:()=>He,each:()=>Ge,equalTo:()=>te,genBlock:()=>pe,genBlockContent:()=>W,genCss:()=>K,generateUID:()=>Ie,getMountPoint:()=>Ee,getValue:()=>v,grab:()=>ie,greaterThan:()=>X,greaterThanOr:()=>Y,init:()=>De,isArray:()=>q,isEmpty:()=>se,isObject:()=>I,isObservable:()=>x,lessThan:()=>Q,lessThanOr:()=>ee,listState:()=>Me,mappedEvent:()=>Oe,mountPoint:()=>R,notEmpty:()=>ne,notEqualTo:()=>re,onLifecycle:()=>Te,removeFromList:()=>w,resetMountPoints:()=>Ae,restoreMountPoint:()=>Z,singleEvent:()=>H,state:()=>de,stateAdd:()=>ue,stateAddAt:()=>ce,stateRemove:()=>fe,stateRemoveWhere:()=>B,styleManager:()=>F,swapItems:()=>xe,tag:()=>m,text:()=>j,uuidv4:()=>_e,val:()=>b,withLifecycle:()=>Ke,withMountPoint:()=>Pe});var J={};h(J,{clearMountPoints:()=>Se,context:()=>l,createGlobalObserver:()=>N,generateUID:()=>Ie,getMountPoint:()=>Ee,mountPoint:()=>R,resetMountPoints:()=>Ae,restoreMountPoint:()=>Z,uuidv4:()=>_e,withMountPoint:()=>Pe});var U={};h(U,{CEvent:()=>A,CMappedEvent:()=>k,mappedEvent:()=>Oe,singleEvent:()=>H});var D={};h(D,{arraysEqual:()=>Ce,camelToDash:()=>S,deepEquals:()=>E,isArray:()=>q,isObject:()=>I,removeFromList:()=>w,swapItems:()=>xe,val:()=>b});var w=(r,e)=>{if(!e)return!1;let t=e.indexOf(r);return t!==-1?(e.splice(t,1),!0):!1},S=r=>r.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`),I=r=>typeof r=="object"&&!(r instanceof Array),q=r=>Object.prototype.toString.call(r)==="[object Array]",b=(r,...e)=>typeof r=="function"?r(...e):r,xe=(r,e,t)=>{let s=r[e];return r[e]=r[t],r[t]=s,r},Ce=(r,e)=>{if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0},E=(r,e)=>{if(r===e)return!0;if(r&&e&&r.length!==e.length)return!1;if(r&&e&&typeof r=="object"&&typeof e=="object"){if(r.constructor!==e.constructor)return!1;var t,s,n;if(Array.isArray(r)){if(t=r.length,t!=e.length)return!1;for(s=t;s--!==0;)if(!E(r[s],e[s]))return!1;return!0}if(r.constructor===RegExp)return r.source===e.source&&r.flags===e.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===e.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===e.toString();if(n=Object.keys(r),t=n.length,t!==Object.keys(e).length)return!1;for(s=t;s--!==0;)if(!Object.prototype.hasOwnProperty.call(e,n[s]))return!1;for(s=t;s--!==0;){var i=n[s];if(!E(r[i],e[i]))return!1}return!0}return r!==r&&e!==e};var A=class{constructor(){this._listeners=[]}listen(e){this._listeners.push(e)}remove(e){w(e,this._listeners)}dispatch(e){this._listeners.forEach(t=>t(e))}destroy(){this._listeners=[]}},k=class{constructor(){this._listeners={}}listen(e,t){e in this._listeners?this._listeners[e]&&this._listeners[e].push(t):this._listeners[e]=[t]}remove(e,t){w(t,this._listeners[e])}dispatch(e,t){e in this._listeners&&this._listeners[e].forEach(s=>s(t))}destroy(){this._listeners={}}},H=()=>new A,Oe=()=>new k;var l={mountPoint:void 0,mountPointHistory:[]},Fe=0;function Ie(){return`_card_${Fe++}`}function _e(){return"_card_10000000".replace(/[018]/g,r=>(+r^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+r/4).toString(16))}var Ee=()=>l.mountPoint,R=r=>(l.mountPoint&&l.mountPointHistory.push(l.mountPoint),l.mountPoint=r,r),Z=()=>{l.mountPoint=l.mountPointHistory.pop()},Se=()=>{l.mountPoint=void 0,l.mountPointHistory=[]},Ae=()=>{let r=l.mountPointHistory.shift();l.mountPoint=r,l.mountPointHistory=[]},Pe=(r,e)=>{R(r),e(r),Z()},N=()=>{let r=H(),e=H();return new window.MutationObserver((s,n)=>{for(let i of s){for(let a of Array.from(i.addedNodes))r.dispatch(a);for(let a of Array.from(i.removedNodes))e.dispatch(a)}}).observe(document.body,{childList:!0,subtree:!0}),{onAdded:r,onRemoved:e}};var le={};h(le,{CTag:()=>P,tag:()=>m});var ae={};h(ae,{text:()=>j});var oe={};h(oe,{Observable:()=>M,compute:()=>p,computeMultiple:()=>Ne,createObservable:()=>g,equalTo:()=>te,getValue:()=>v,grab:()=>ie,greaterThan:()=>X,greaterThanOr:()=>Y,isEmpty:()=>se,isObservable:()=>x,lessThan:()=>Q,lessThanOr:()=>ee,notEmpty:()=>ne,notEqualTo:()=>re});var M=class extends A{constructor(t,s){super();this.computed=t=>p(this,t);this.greaterThan=(t=0)=>X(this,t);this.greaterThanOr=(t=0)=>Y(this,t);this.lessThan=(t=0)=>Q(this,t);this.lessThanOr=(t=0)=>ee(this,t);this.equalTo=t=>te(this,t);this.notEqualTo=t=>re(this,t);this.isEmpty=()=>se(this);this.notEmpty=()=>ne(this);this.grab=(t,s)=>ie(this,t,s);t&&(I(t)||q(t))&&(t=new Proxy(t,{get(n,i,a){return n[i]},set:(n,i,a,o)=>(n[i]===a||(n[i]=a,super.dispatch(n)),!0),deleteProperty:(n,i)=>(delete n[i],super.dispatch(n),!0)})),this._value=t,this._destroyer=s}get value(){return this._value}set value(t){this.dispatch(t)}valueOf(){return this._value}toString(){return this._value.toString()}changed(t){return this.listen(t),this}remove(t){return super.remove(t),this}dispatch(t){return t===this._value?this:(this._value=t,super.dispatch(t),this)}destroy(){this._destroyer&&this._destroyer(),this._value=null,super.destroy()}},x=r=>r instanceof M,g=(r,e)=>new M(r,e),p=(r,e)=>{let t,s=n=>t?.dispatch(e(n));return t=g(e(r.value),()=>{r.remove(s),t=null,r=null}),r.changed(s),t},Ne=(r,e)=>{let t=g(e(...r.map(s=>s.value)));for(let s of r)s.changed(()=>t.dispatch(e(...r.map(n=>n.value))));return t},v=r=>x(r)?r.value:r,X=(r,e=0)=>p(r,t=>t>v(e)),Y=(r,e=0)=>p(r,t=>t>=v(e)),Q=(r,e=0)=>p(r,t=>t<v(e)),ee=(r,e=0)=>p(r,t=>t<=v(e)),te=(r,e)=>p(r,t=>t===v(e)),re=(r,e)=>p(r,t=>t!==v(e)),se=r=>p(r,e=>e.length<=0),ne=r=>p(r,e=>e.length>0),ie=(r,e,t)=>p(r,s=>s&&s[e]?s[e]:t);var j=(r,e)=>{let t=document.createTextNode(""),s=/\B\$([0-9]+|[a-z][a-z0-9_$]*)/gi;if(!e)return t.nodeValue=r,t;let n=i=>{t.nodeValue=i?r.replace(s,(a,o)=>(i[o]??a).toString()):r};if(x(e))e.changed(i=>n(i)),n(e.value);else if(I(e)){for(let i of Object.getOwnPropertyNames(e))r.includes(`$${i}`)&&x(e[i])&&e[i].changed(()=>n(e));n(e)}return t};var P=class r{constructor(e,t=[],s=!1){this._destroyers=[];this._children=[];this._cachedChildren=[];this._meta={isHidden:!1,nextSiblingID:null};if(typeof e=="string"&&e.match(/\(.+\)/)){let i=e.match(/\(([\.\#]?[a-zA-Z][a-zA-Z0-9_$]+)\)/),a=i?i[1]:null;if(!a)throw new Error(`'${e}' is not a valid selector`);let o=document.querySelector(a);if(!o)throw new Error("Can't find element for selector: "+e);this.el=o}else if(typeof e=="string")this.el=document.createElement(e),l.mountPoint&&s&&l.mountPoint.append(this);else if(e instanceof HTMLElement)this.el=e;else throw new Error("Invalid argument: "+e);t.length>0&&this.setChildren(t)}get parent(){return this._parent}set parent(e){this._parent=e}get children(){return this._getChildren(this.el)}get value(){return this.el.value}setValue(e){return this.el.value=e,this}get checked(){return this.el.checked}setChecked(e){return this.el.checked=e,this}get style(){return this.el.style}get className(){return this.el.className}get classList(){return this.el.classList}get consumeValue(){let e=this.value;return this.clear(),e}get id(){return this.el.id}setId(e){return this.el.id=e,this}setChildren(e){return this.el.replaceChildren(...this._mapChildren(e)),this._children=e,this}append(...e){return this.el.append(...this._mapChildren(e)),this._children.push(...e),this}prepend(...e){return this.el.prepend(...this._mapChildren(e)),this._children.unshift(...e),this}async show(){if(this.parent&&!this.parent.children.includes(this.el)){let e=this.parent.el,t=this.parent._children.indexOf(this);if(t===0)e.prepend(this.el);else if(t===this.parent._children.length-1)e.append(this.el);else{let s=0;for(let i=t-1;i>=0;i--){let a=this.parent._children[i];a instanceof r&&a._meta.isHidden&&s++}let n=e.childNodes[t-s];e.insertBefore(this.el,n)}}return this._meta.isHidden=!1,!0}async hide(){this.parent&&this.parent.children.includes(this.el)&&(await this.remove(),this._meta.isHidden=!0)}consume(e,t){if(e.changed){let s=n=>t(this,n);e.changed(s),this._destroyers.push(()=>{e.remove(s),e=null})}else console.warn("An invalid Observable was supplied to `tag.consume`");return t(this,"value"in e?e.value:e),this}doIf(e,t,s,n=!1){if(n){let a=t;t=s,s=a}let i=(a,o)=>{o?t(o):s(o)};return this.consume(e,i)}doIfNot(e,t,s){return this.doIf(e,t,s,!0)}hideIf(e,t=!1){let s=(n,i)=>{let a=t?!i:!!i;this._meta.isHidden=a,this.parent&&(a?this.hide():this.show())};return this.consume(e,s)}hideIfNot(e){return this.hideIf(e,!0)}classIf(e,t,s=!1){return this.doIf(e,()=>this.addClass(...b(t,this)),()=>this.rmClass(...b(t,this)),s)}classIfNot(e,t){return this.classIf(e,t,!0)}textIf(e,t,s="",n=!1){return this.doIf(e,()=>this.text(b(t,this)),()=>this.text(b(s,this)),n)}textIfNot(e,t,s=""){return this.textIf(e,t,s,!0)}attrIf(e,t,s="",n=!1){return this.doIf(e,()=>this.addAttr(t,b(s,this)),()=>this.rmAttr(t),n)}attrIfNot(e,t,s=""){return this.attrIf(e,t,s,!0)}disableIf(e,t=!1){return this.attrIf(e,"disabled","",t)}disableIfNot(e){return this.disableIf(e,!0)}styleIf(e,t,s="",n=!1){return this.doIf(e,()=>this.addStyle(t,b(s,this)),()=>this.rmStyle(t),n)}styleIfNot(e,t,s=""){return this.styleIf(e,t,s,!0)}stylesIf(e,t,s=!1){return this.doIf(e,()=>this.setStyle(b(t,this)),()=>this.rmStyle(...Object.keys(t)),s)}stylesIfNot(e,t){return this.stylesIf(e,t,!0)}listen(e,t,s){return e.on(t,(n,i)=>{s(this,n,i)})}text(e,t){return e==null?this.el.textContent:t&&e?this.setChildren([j(e,t)]):(this.el.textContent=e,this)}config(e){if(e.attr&&this.setAttrs(e.attr),e.classList&&this.addClass(...e.classList),e.className&&this.setClassName(e.className),e.style&&this.setStyle(e.style),e.text&&this.text(e.text),e.value&&this.setValue(e.value),e.children&&this.append(...e.children),e.on)for(let t of Object.keys(e.on))this.on(t,e.on[t]);return this}addClass(...e){return this.classList.add(...e),this}setClassName(e){return this.el.className=e,this}rmClass(...e){for(let t of e)this.classList.remove(t);return this}hasClass(...e){for(let t of e)if(!this.classList.contains(t))return!1;return!0}replaceClass(e,t){return this.classList.replace(e,t),this}toggleClass(e){return this.hasClass(e)?this.rmClass(e):this.addClass(e)}addStyle(e,t){return this.el.style[e]=t,this}setStyle(e){for(let t in e)this.addStyle(t,e[t]??"");return this}rmStyle(...e){for(let t of e)this.style.removeProperty(S(t));return this}hasStyle(...e){for(let t of e)if(!this.style.getPropertyValue(S(t)))return!1;return!0}setAttrs(e){for(let t in e)this.addAttr(t,e[t]);return this}addAttr(e,t=""){return this.el.attributes[e]=t,this.el.setAttribute(e,t),this}rmAttr(...e){for(let t of e)this.el.removeAttribute(t),delete this.el.attributes[t];return this}hasAttr(...e){for(let t of e)if(!(t in this.el.attributes))return!1;return!0}getAttr(e){return this.el.attributes[e]}when(e,t){let s=g({});return this.on(e,(n,i)=>{s.dispatch(t(n,i))}),s}on(e,t){if(t){let s=n=>t(this,n);this.el.addEventListener(e,s),this._destroyers.push(()=>{this.el.removeEventListener(e,s)})}return this}once(e,t){let s=n=>{t(this,n),this.el.removeEventListener(e,s)};return this.el.addEventListener(e,s),this}clicked(e){return this.on("click",e)}keyPressed(e,t){return t?this.on("keypress",(s,n)=>{(n.code===t||n.key===t)&&e(this,n)}):this.on("keypress",e)}changed(e){return this.on("change",e)}submited(e){return this.on("submit",e)}async remove(){let e=this.el.remove();return e instanceof Promise&&await e,await this.el.remove(),this}destroy(){this._children.forEach(e=>{e instanceof r&&e.destroy()}),this._destroyers.forEach(e=>e()),this._children=[],this._cachedChildren=[],this.remove()}clear(){return this.el.value="",this.el.dispatchEvent(new InputEvent("input")),this}disable(){return this.setDisabled(!0)}enable(){return this.setDisabled(!1)}setDisabled(e){return e?this.addAttr("disabled"):this.rmAttr("disabled")}q(e){let t=this.el.querySelector(e);if(t)return new r(t)}find(e){for(let t of this._children)if(e(t))return t}findTag(e){for(let t of this._children)if(t instanceof r&&e(t))return t}_childrenFilterPredicate(e){return!(e instanceof r&&e._meta.isHidden)}_getElementForChild(e){return typeof e=="string"?document.createTextNode(e):x(e)?j("$val",{val:e}):e instanceof r?e.el:e instanceof Node?e:null}_getChildren(e){return this._observer||(this._observer=new MutationObserver(()=>{this._cacheChildren(e)}),this._observer.observe(this.el,{childList:!0}),this._cacheChildren(e)),this._cachedChildren}_cacheChildren(e){let t=e.childNodes,s=[],n=t.length;for(;n--;)t[n].nodeType===1&&s.unshift(t[n]);this._cachedChildren=s}_mapChildren(e){let t=[];for(let s of e)if(s instanceof r&&(s.parent=this),this._childrenFilterPredicate(s)){let n=this._getElementForChild(s);n!=null&&t.push(n)}return t}},m=(r,e=[],t=!1)=>new P(r,e,t);var he={};h(he,{listState:()=>Me,state:()=>de,stateAdd:()=>ue,stateAddAt:()=>ce,stateRemove:()=>fe,stateRemoveWhere:()=>B});var de=r=>g(r),Me=r=>{let e=de(r.map(n=>g(n)));return{get list(){return e},get listValue(){return e.value},add:n=>{ue(e,g(n))},addAt:(n,i)=>{ce(e,g(n),i)},remove:fe.bind({},e),removeWhere:B.bind({},e),length:e.computed(n=>n.length)}},ue=(r,e)=>{r.value=[...r.value,e]},ce=(r,e,t)=>{let s=[...r.value];s.splice(t,0,e),r.value=s,s=[]},B=(r,e)=>{r.value=r.value.filter((t,s)=>!e(t,s))},fe=(r,e)=>{let t=r.value.findIndex(s=>v(s)===v(e));B(r,(s,n)=>t===n)};var me={};h(me,{genBlock:()=>pe,genBlockContent:()=>W,genCss:()=>K});var K=r=>{let e=r instanceof Array?r:[r],t="";for(let s of e)for(let n in s)t+=pe(n,s[n]);return t},pe=(r,e)=>W(r,e).join(""),W=(r,e)=>{let t="",s=[];for(let n in e)if(I(e[n])){let i=r;n.match(/^[a-z.]/)?i+=` ${n}`:i+=n,s.push(...W(i,e[n]))}else e[n]&&(t+=`${S(n)}:${e[n]};`);return s.unshift(`${r}{${t}}`),s};var ge={};h(ge,{onLifecycle:()=>Te,withLifecycle:()=>Ke});function Te(r,e,t,s){if(s){let a=r.el.remove;r.el.remove=async()=>{let o=s(r);return(!o||o instanceof Promise&&await o)&&a.call(r.el),o.valueOf()}}if(e){let a=r.show;r.show=async()=>{let o=a.call(r);return o instanceof Promise?await o:o}}l.observer||(l.observer=N());let n,i;l.observer.onAdded.listen(n=async a=>{if(a===r.el&&e){let o=e(r);o instanceof Promise&&await o}}),l.observer.onRemoved.listen(i=a=>{a===r.el&&t&&t(r)}),r._destroyers.push(()=>{l.observer?.onRemoved.remove(i),l.observer?.onAdded.remove(n),t=void 0,e=void 0})}var Ke=(r,e)=>(Te(r,e.mounted,e.unmounted,e.beforeUnmounted),r);var ve={};h(ve,{allTags:()=>Le});var z={ul:(r,e=!1)=>m("ul",r.map(t=>m("li",[t],e))),style:(r,e=!1)=>m("style",[K(r)],e)},Le=new Proxy({},{get:(r,e,t)=>{let s=e.toString(),n=(...i)=>z[s]?z[s](i,!1):m(s,i);return Object.defineProperty(n,"mount",{get:()=>(...i)=>z[s]?z[s](i,!0):m(s,i,!0)}),n}});var be={};h(be,{styleManager:()=>F});var we="cardboard-styles",ye=class{constructor(){this.generatedIdsCount=0;this.rules=new Set;let e=null;try{e=m(`(#${we})`)}catch{e=m("style").setId(we)}m("(head)").append(e),this.styleTag=e}add(e){let t=K(e);this.rules.has(t)||(this.rules.add(t),this.styleTag.append(t))}},F=new ye;var ke=(n=>(n.unchanged="unchanged",n.added="added",n.removed="removed",n.swap="swap",n))(ke||{});function Ge(r,e,t){let s=document.createTextNode(""),n=[],i=[],a=0,o=[],$={added:d=>{if(d.index>=0){let c=e(d.entry),u=n[d.index];n.splice(d.index,0,c),s.parentElement?.insertBefore(c.el,u?u.el:s)}},removed:d=>{s.parentElement?.removeChild(o[d.index].el),o[d.index].destroy();let c=n.indexOf(o[d.index]);n.splice(c,1)},swap:d=>{let c=d.index,u=d.targetIndex??0;if(c>=0&&u>=0){let f=o[c],T=o[u],O=f.el.parentNode,L=f.el.nextSibling;O&&L===T.el?O.insertBefore(T.el,f.el):T.el.parentNode&&(T.el.parentNode.insertBefore(f.el,T.el),L&&O?O.insertBefore(T.el,L):O&&O.appendChild(T.el));let je=o[c];o[c]=o[u],o[u]=je;let $e=n[c];n[c]=n[u],n[u]=$e}}},V=100,C=(d,c=0)=>{if(!s.parentElement){c<V?setTimeout(()=>C(d,c+1),1):console.warn("[each]: parentElement not found after max retries");return}a||(a=Array.from(s.parentElement?.childNodes??[]).indexOf(s));let u=He(d,i,t);if(!(u.length<=0)){for(let f=0;f<u.length;f++){let T=u[f],O=u[f+1]?u[f+1].index:null,L=u[f+1]?u[f+1].state:null;$[T.state](T),L==="swap"&&O===T.targetIndex&&f++}i=[...d].slice(0),o=n.slice(0)}};return C("value"in r?r.value:r),x(r)&&r.changed(C),s}function He(r,e,t=s=>s){let s=[],n=r.length,i=e.length;if(n===i&&(r==e||E(e,r)))return s;if(n<=0){for(let o=0;o<i;o++)s[o]={entry:e[o],state:"removed",index:o};return s}if(!i){for(let o=0;o<n;o++)s[o]={entry:r[o],state:"added",index:o};return s}let a=0;for(let o=0;o<i;o++){let y=r[o-a],_=e[o];if(t(_)==t(y)||E(_,y))continue;let $=!!r.find(C=>t(_)==t(C)),V=!!e.find(C=>t(y)==t(C));if(!V&&$){s.push({entry:y,state:"added",index:o-a}),a--;continue}if(V&&!$||y==null){s.push({entry:_,state:"removed",index:o}),a++;continue}if(r.indexOf(_)>=0){s.push({entry:y,targetEntry:_,state:"swap",index:e.indexOf(r[o-a]),targetIndex:e.indexOf(e[o])});let C=e.indexOf(y),d=e[o];e[o]=r[o-a],e[C]=d;continue}}if(a!=i)for(let o=i-a;o<n;o++){let y=r[o];s.push({entry:y,state:"added",index:o})}return s}var De=(r={selector:"body"})=>{let e=new P(`(${r.selector})`);return l.observer=N(),l.styleManager=F,R(e)},Ue={...le,...he,...me,...D,...ae,...U,...oe,...ge,...J,...ve,...be,version:"0.0.4"};return ze(Ze);})();
